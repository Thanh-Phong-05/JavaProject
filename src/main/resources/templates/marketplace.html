<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chợ Giao Dịch Tín chỉ Carbon</title>
    <th:block th:insert="~{fragments :: head}" />
</head>
<body>

    <div th:replace="~{fragments :: navbar}"></div>

    <div class="container mt-4">
        <h1>Chợ Giao Dịch Tín chỉ Carbon</h1>
        <p>Chào mừng đến với sàn giao dịch. Đây là các tín chỉ đang được rao bán.</p>

        <div th:if="${message}"
             th:class="${#strings.contains(message, 'Lỗi') ? 'alert alert-danger' : 'alert alert-success'}"
             th:text="${message}">
        </div>

        <table class="table table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>ID Giao dịch</th>
                    <th>ID Người bán</th>
                    <th>Số lượng (tấn CO2)</th>
                    <th>Giá (VND / 1 tấn)</th>
                    <th>Hành động (Mua)</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="listing : ${listings}">
                    <td th:text="${listing.id}">1</td>
                    <td th:text="${listing.sellerOwnerId}">100</td>
                    <td th:text="${listing.quantity}">50.0</td>
                    <td th:text="${#numbers.formatCurrency(listing.pricePerCredit)}">1,000,000</td>
                    <td>
                        <form th:action="@{/buy}" method="POST" class="d-flex">
                            <input type="hidden" name="listingId" th:value="${listing.id}" />
                            <input type="number" name="quantity" step="0.01" min="0.01"
                                   th:max="${listing.quantity}" required
                                   class="form-control me-2" style="width: 100px;" />
                            <button type="submit" class="btn btn-success btn-sm">Mua</button>
                        </form>
                    </td>
                </tr>
                <tr th:if="${listings.isEmpty()}">
                    <td colspan="5" class="text-center">Hiện chưa có ai rao bán tín chỉ.</td>
                </tr>
            </tbody>
        </table>
    </div> <div th:replace="~{fragments :: footer-scripts}"></div>
</body>
</html>