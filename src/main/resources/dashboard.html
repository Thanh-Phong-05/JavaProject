<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bảng điều khiển EV Owner</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
        .wallet, .report { background-color: #f9f9f9; padding: 15px; border-radius: 5px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Xin chào, <span th:text="${owner.username}">Tên Người Dùng</span>!</h1>
    <p>Chào mừng bạn trở lại bảng điều khiển quản lý tín chỉ Carbon.</p>

    <div class="wallet">
        <h2>Ví của bạn</h2>
        <p>
            Số dư tín chỉ (Credits):
            <strong th:text="${#numbers.formatDecimal(owner.creditBalance, 1, 2)}">0.00</strong> CC
        </p>
        <p>
            Số dư tiền mặt (Cash):
            <strong th:text="${#numbers.formatCurrency(owner.cashBalance)}">0</strong> VND
        </p>
    </div>

    <div>
        <h2>Đồng bộ hành trình (Upload CSV)</h2>
        
        <div th:if="${message}" 
             th:class="${#strings.contains(message, 'thất bại') ? 'error' : 'success'}"
             th:text="${message}">
            </div>

        <form method="POST" th:action="@{/trips/upload}" enctype="multipart/form-data">
            <p>
                Chọn file CSV hành trình của bạn:
                <input type="file" name="file" accept=".csv" required>
            </p>
            <p>
                <button type="submit">Tải lên và xử lý</button>
            </p>
        </form>
    </div>

    <div>
        <h2>Niêm yết Tín chỉ Carbon để bán</h2>
        
        <form method="POST" th:action="@{/listings/create}">
            <p>
                Số lượng bán:
                <input type="number" step="0.01" name="quantity" required>
            </p>
            <p>
                Giá mỗi tín chỉ (VND):
                <input type="number" step="1000" name="price" required>
            </p>
            <p>
                <button type="submit">Đăng bán</button>
            </p>
        </form>
    </div>

    <div class="report">
        <h2>Báo cáo cá nhân</h2>
        <p>
            Tổng quãng đường đã đi:
            <span th:text="${#numbers.formatDecimal(totalDistance, 1, 1)}">0.0</span> km
        </p>
        <p>
            Tổng CO2 đã tiết kiệm (ước tính):
            <span th:text="${#numbers.formatDecimal(totalCO2Saved, 1, 2)}">0.00</span> kg
        </p>
    </div>

    <h2>Tín chỉ Carbon của bạn</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Số lượng (tấn CO2)</th>
                <th>Ngày phát hành</th>
                <th>Trạng thái</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="credit : ${credits}">
                <td th:text="${credit.id}">1</td>
                <td th:text="${credit.quantity}">5.2</td>
                <td th:text="${credit.issuedAt}">2025-01-01</td>
                <td th:text="${credit.verified ? 'Đã xác minh' : 'Chưa xác minh'}">Chưa xác minh</td>
            </tr>
            <tr th:if="${credits.isEmpty()}">
                <td colspan="4" style="text-align: center;">Bạn chưa có tín chỉ carbon nào.</td>
            </tr>
        </tbody>
    </table>

    <h2>Lịch sử hành trình</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Ngày đi</th>
                <th>Quãng đường (km)</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="trip : ${trips}">
                <td th:text="${trip.id}">101</td>
                <td th:text="${trip.date}">2025-01-05</td>
                <td th:text="${trip.distanceKm}">150.5</td>
            </tr>
            <tr th:if="${trips.isEmpty()}">
                <td colspan="3" style="text-align: center;">Chưa có dữ liệu hành trình.</td>
            </tr>
        </tbody>
    </table>

</body>
</html>